(function(){function t(e){return _.isArray(e)?e:[e]}function n(n,r){if(e)return;e=n.View.extend({constructor:function(e){n.View.prototype.constructor.apply(this,arguments),this._views={},this._eventBindings=[],this._remove=[],this._parent=null,this._bubble=null},bindTo:function(e,t,n,r){var i;r=r||this,typeof n=="string"&&(n=this[n]);if(!e||!t||!n)throw new Error("Bad arguments. The signature is <emitter>, <event>, <callback / callback name>, [context]");return i={emitter:e,context:r,callback:n,event:t},e.on(t,n,r),this._eventBindings.push(i),i},unbindAll:function(){var e;while(e=this._eventBindings.shift())this.unbindFrom(e);return this},unbindFrom:function(e){return e.emitter.off(e.event,e.callback,e.context||this),this},elements:{},template:function(){throw new Error("Template function not defined!")},context:function(){return this.model?this.model.toJSON():{}},render:function(e){e=r.extend({},e),this._detachViews(),e.detach=!1,this.$el.html(this.template(this.context()));var t,n;for(t in this.elements)n=this.elements[t],this[t]=this.$(n);return this.rendered=!0,this.renderViews(e),this},renderViews:function(e){var t=this;e=r.extend({detach:!0},e);var n;while(n=this._remove.shift())n.remove();return e.detach&&this._detachViews(),this.eachView(function(t,n){(e.force||!n.rendered)&&n.render(e)}),this.eachView(function(e,n){t.$(e).append(n.el)}),this},detachParent:function(){if(!this._parent)return;var e;for(e in this._parent._views)this._parent._views[e]=r.without(this._parent._views[e],this);this.unbindFrom(this._bubble),this._bubble=null,this._parent=null},_prepareViews:function(e){var n=this;t(e).forEach(function(e){e._parent&&e._parent!==n&&e.detachParent(),e._bubble||(e._bubble=e.bindTo(e,"all",function(t,r){n.trigger(t,e,r)},e)),e._parent=n})},eachView:function(e){var t=this;r.keys(this._views).forEach(function(n){var r=t._views[n];if(!r)return;r.forEach(function(t){e(n,t)})})},_detachViews:function(){this.eachView(function(e,t){t.$el.detach()})},setViews:function(e,n){var i;n=t(n);if(i=this._views[e])this._remove=this._remove.concat(r.difference(i,n));return this._prepareViews(n),this._views[e]=n,this},getViews:function(e){return this._views[e]},appendViews:function(e,n){return this._prepareViews(n),this._views[e]=(this._views[e]||[]).concat(t(n)),this},prependViews:function(e,n){return this._prepareViews(n),this._views[e]=t(n).concat(this._views[e]||[]),this},removeViews:function(e,n){return this._views[e]?(n=t(n),this._views[e]=r.difference(this._views[e],n),this._remove=this._remove.concat(n),this):this},remove:function(){return n.View.prototype.remove.apply(this,arguments),this.unbindAll(),this.detachParent(),this}})}var e;typeof Backbone=="object"&&typeof _=="function"&&(n(Backbone,_),window.ViewMaster=Backbone.ViewMaster=e),typeof define=="function"&&define.amd&&define(["backbone","underscore"],function(t,r){return n(t,r),e})})();