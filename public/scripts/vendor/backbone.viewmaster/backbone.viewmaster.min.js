(function(){function n(n,r){function i(e){return r.isArray(e)?e:[e]}if(e&&t)return;e=n.View.extend({template:function(){throw new Error("Template function not defined!")},elements:{},constructor:function(){n.View.prototype.constructor.apply(this,arguments),this._eventBindings=[]},viewJSON:function(){return this.model?this.model.toJSON():{}},render:function(){this.$el.html(this.template(this.viewJSON()));var e,t;for(e in this.elements)t=this.elements[e],this[e]=this.$(t);return this},bindTo:function(e,t,n,r){var i;r=r||this,typeof n=="string"&&(n=this[n]);if(!e||!t||!n)throw new Error("Bad arguments. The signature is <emitter>, <event>, <callback / callback name>, [context]");return e.on(t,n,r),i={emitter:e,context:r,callback:n,event:t},this._eventBindings.push(i),i},unbindAll:function(){var e,t;for(t=0;t<this._eventBindings.length;t+=1)e=this._eventBindings[t],e.emitter.off(e.event,e.callback,e.context);this._eventBindings=[]},remove:function(){return n.View.prototype.remove.apply(this,arguments),this.unbindAll(),this}}),t=e.extend({constructor:function(t){e.prototype.constructor.apply(this,arguments),t&&(this.views=t.views);var n=this.views=this.views||{};r.keys(n).forEach(function(e){n[e]=i(n[e])}),this._remove=[]},eachView:function(e){var t=this;r.keys(this.views).forEach(function(n){var r=t.views[n];if(!r)return;r.forEach(function(t){e(n,t)})})},_detachViews:function(){this.eachView(function(e,t){t.$el.detach()})},render:function(t){return t=r.extend({},t),this._detachViews(),t.detach=!1,e.prototype.render.apply(this,arguments),this.renderViews(t),this},renderViews:function(e){var t=this;e=r.extend({detach:!0},e);var n;while(n=this._remove.shift())n.remove();return e.detach&&this._detachViews(),this.eachView(function(t,n){if(e.force||!n.rendered)n.render(e),n.rendered=!0}),this.eachView(function(e,n){t.$(e).append(n.el)}),this},setViews:function(e,t){var n=this,s;t=i(t);if(s=this.views[e]){var o=r.difference(s,t);o.forEach(function(e){n._remove.push(e)})}return this.views[e]=t,this},getViews:function(e){return this.views[e]},appendViews:function(e,t){return this.views[e]=(this.views[e]||[]).concat(i(t)),this},prependViews:function(e,t){return this.views[e]=i(t).concat(this.views[e]||[]),this},removeViews:function(e,t){var n=this;return this.views[e]?(t=i(t),this.views[e]=r.reject(this.views[e],function(e){return r.contains(t,e)}),t.forEach(function(e){n._remove.push(e)}),this):this}})}var e,t;typeof Backbone=="object"&&typeof _=="function"&&(n(Backbone,_),Backbone.PuppetView=e,Backbone.ViewMaster=t),typeof define=="function"&&define.amd&&(define("puppetview",["backbone","underscore"],function(t,r){return n(t,r),e}),define("puppetview",["backbone","underscore"],function(e,r){return n(e,r),t}))})();